@page "/"
@using Models.Characters
@using Persistence.Json
@using UI.Services
@inject IStorageService Storage

<MudContainer>
	<MudStack>
		<MudText Typo=Typo.h3 Style="margin: 20px 0;">@HeaderText</MudText>

		@foreach (var character in Characters)
		{
			<MudCard>
				<MudCardHeader>
					<MudStack>
						<MudLink Href="@character.Link">
							<MudText Typo="Typo.h6">@character.Alias the @character.Playbook</MudText>
						</MudLink>
					</MudStack>
				</MudCardHeader>
				<MudCardContent>
					<MudStack>
						<MudText>@character.Blurb</MudText>
					</MudStack>
				</MudCardContent>
			</MudCard>
		}

		<MudCard>
			<MudCardContent>
				<MudLink Href="/new" Typo=Typo.h5>Create a new character!</MudLink>
			</MudCardContent>
		</MudCard>
	</MudStack>
</MudContainer>

@code
{
	IReadOnlyCollection<VIndexCharacter> Characters { get; set; } = Array.Empty<VIndexCharacter>();

	protected override async Task OnInitializedAsync()
	{
		var characters = await Storage.LoadAll();
		Characters = characters.Select(c => new VIndexCharacter(c))
			.ToArray();

		await base.OnInitializedAsync();
	}

	string HeaderText => Characters.Any() ? "Your scoundrels await:"
		: "A Blades in the Dark Character Sheet App";
}